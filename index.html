<html>
<head>
	<title>Momentum Test</title>
	
  <!-- ... -->
  <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="bower_components/moment/min/moment.min.js"></script>
  <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" href="bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
  
  <!-- <script type="text/javascript" src = "bloodhound/bloodhound.js"></script> -->
  <!-- <script type="text/javascript" src = "bloodhound/typeahead.bundle.js"></script> -->
  <!-- <script type="text/javascript" src = "bloodhound/typeahead.jquery.js"></script> -->
  <!-- <script type="text/javascript" src = "bloodhound/bootstrap-tokenfield.min.js"></script> -->
  <!-- <link rel="stylesheet" type="text/css" href="bloodhound/bootstrap-tokenfield.css"> -->
  <!-- <link rel="stylesheet" type="text/css" href="css/example.css"> -->
  <!-- <script type="text/javascript" src = "bloodhound/bootstrap-typeahead.js"></script> -->

</head>

<body>

	
    <!-- <section id="first">
    <div class="container banner-container">
      <div class="row first-con">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-6 col-sm-offset-3" id="banner-heading" >
              <h1>AIMS QUANT</h1><br>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-10 col-sm-offset-1" id="banner-txt">
              <h4>Get the Power to anlyse how the stocks are playing and get into Momentum Investing.
              </h4>
            </div>
          </div>
        </div>
      </div>
    </div>  
  </section> -->

  <div class = "container">

    <section id="second">
      <h1>AIMS QUANT</h1>
      <h3>Select the Stock Symbols and time period to analyse.</h3><br>
  		<form>
        <ul class="list-group">
          <li class="list-group-item">
            
            <span id = "inlineCheckbox1">SAIL<input class="check" style="float : right" type="checkbox" id="inlineCheckbox1" value="SAIL">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox2">ABB<input class="check" style="float : right" type="checkbox" id="inlineCheckbox2" value="ABB">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox3">OIL<input class="check" style="float : right" type="checkbox" id="inlineCheckbox3" value="OIL">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox4">PFC<input class="check" style="float : right" type="checkbox" id="inlineCheckbox4" value="PFC">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">DLF<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="DLF">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">APOLLOHOSP<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="APOLLOHOSP">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">ASHOKLEY<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="ASHOKLEY">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">BAJFINANCE<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="BAJFINANCE">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">BAJAJFINSV<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="BAJAJFINSV">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">BEL<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="BEL">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">BHARATFORG<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="BHARATFORG">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">BRITANNIA<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="BRITANNIA">        
          </li><li class="list-group-item">
            
            <span id = "inlineCheckbox5">CADILAHC<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="DLF">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">DABUR<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="DABUR">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">CONCOR<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="CONCOR">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">DIVISLAB<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="DIVISLAB">        
          </li>
          <li class="list-group-item">
            
            <span id = "inlineCheckbox5">NHPC<input class="check" style="float : right" type="checkbox" id="inlineCheckbox5" value="NHPC">        
          </li>


        </ul>
  			<div class="form-group">
          <div class="row" style= "margin-bottom : 2%;">
    				<div id="bloodhound" class="example">
              <!-- <input class="typeahead" name = "Symbol" type="text" placeholder="Stock Symbols"> -->
            </div>
          </div> 
  				  <div class='col-md-5'>
              <div class="form-group">
                <div class='input-group date' id='datetimepicker6'>
                    <input type='text' name = "start-date" class="form-control" placeholder="Start Date" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
              </div>
            </div>
          <div class='col-md-5'>
            <div class="form-group">
              <div class='input-group date' id='datetimepicker7'>
                  <input type='text' name = "end-date" class="form-control" placeholder="Finish Date" />
                  <span class="input-group-addon">
                      <span class="glyphicon glyphicon-calendar"></span>
                  </span>
              </div>
            </div>
          </div>
        </div>
          <button class="btn" type="submit" id="submit"> ANALYSE </button>
  		</form>
      <br><br><br><br><br>

      <div class="response-table">
        <h2 id="query-term">Analysis for the Stock Symbols </h2>
        <table class="table table-hover">
            <thead>
              <tr style = "color : white">
                <th>Symbol</th>
                <th>Rpast</th>
                <th>Rfuture</th>
              </tr>
            </thead>
            <tbody id="table-1">
              
            </tbody>
        </table>
       </div> 
       <br><br>

       <button id="tab-2" class="btn">Top and Bottom Results</button>
       <br><br>
       <div class = "response-tabl" id="top-table">
        <h2 id="query-term">Top Results Based on Rpast </h2>
        <table class="table table-hover">
            <thead>
              <tr style = "color : white">
                <th>Symbol</th>
                <th>Rpast</th>
                <th>Rfuture</th>
              </tr>
            </thead>
            <tbody id="table-2">
              
            </tbody>
        </table>
       </div> 

       <div class = "response-tabe" id="bottom-table">
        <h2 id="query-term">Bottom Results Based on Rpast</h2>
        <table class="table table-hover">
            <thead>
              <tr style = "color : white">
                <th>Symbol</th>
                <th>Rpast</th>
                <th>Rfuture</th>
              </tr>
            </thead>
            <tbody id="table-3">
              
            </tbody>
        </table>
       </div> 
       
       <button id="momentum" class="btn">Find Momentum</button>
       <div class = "response-tabe" id="moment-table">
        <h2 id="query-term">Momentum Analysis Table</h2>
        <table class="table table-hover" >
            <thead>
              <tr style = "color : white">
                <th>Positive Momentum</th>
                <th>Negative Momentum</th>
                <th>Difference</th>
              </tr>
            </thead>
            <tbody id="table-4">
              
            </tbody>
        </table>
       </div> 

      </div>
      
  	</section>
   </div> 



<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script> -->

<script type="text/javascript">
    $(function () {
        $('#datetimepicker6').datetimepicker({
          format : 'YYYY-MM-DD',
          minDate : '2016-01-01',
          maxDate : new Date()
        });
        $('#datetimepicker7').datetimepicker({
            useCurrent: false, //Important! See issue #1075
            format : 'YYYY-MM-DD',
            maxDate : new Date()

        });
        $("#datetimepicker6").on("dp.change", function (e) {
            // e.date : ""
            $('#datetimepicker7').data("DateTimePicker").minDate(e.date);
        });
        $("#datetimepicker7").on("dp.change", function (e) {
            $('#datetimepicker6').data("DateTimePicker").maxDate(e.date);
        });
    });
</script>

<script type="text/javascript">
  $('#submit').on('click', function(e) {
  e.preventDefault();
  $('#tab-2').css({'display' : 'block'});
  // $('.response-table').innerHtml(" ");
  $('#table-1').html(" ");
   
  // $()
  var checkedValues = $('.check:checked').map(function() {
    return this.value;
  }).get();
  rPastDictList = [];
  rFutureDictList = [];

  $.each(checkedValues, function(i){

      var formData = {
        'symbol' : checkedValues[i],
        'startDate' : $('input[name=start-date]').val(),
        'endDate' : $('input[name=end-date]').val()
      }
      var api_url = "https://www.quandl.com/api/v3/datasets/NSE/" + formData['symbol'] + ".json?api_key=gWf2CLShwrGUBVnqzsT4&start_date=" +formData['startDate'] + "&end_date=" + formData['endDate'] + "yyyy-mm-dd"  
      // var rPastArray = [];
      // var rFutureArray = [];
      // console.log(api_url);
      $.ajax({
        type: 'GET',
        url : api_url,
        data : formData,
        dataType : 'json',
        success : function(response){
          len = response['dataset']['data'].length
          resArray = response['dataset']['data']
          console.log(resArray)
          
          mid = parseInt(len/2);
          var rPast = Math.log(resArray[mid-1][7]/(resArray[mid][1]));
          var rFuture = Math.log(resArray[len-1][7]/(resArray[mid][1]));
          

          rPastDictList.push({
            key: checkedValues[i],
            value: rPast,
            rfut: rFuture
            });
          // rFutureDictList.push({
          //   key : checkedValues[i],
          //   value : rFuture
          // });

          // table to show the results of the rpast and rfurture for the searched symbol
          $('.response-table').css({'display': "block"});
          
          $('#table-1').append('<tr style = "color : white"><td style = "color : white">' + formData['symbol'] + '</td>\
            <td>' + rPast + '</td><td>' + rFuture + '</td></tr>');

        },

        error: function(xhr){
          $('#query-term').innerHtml("Sorry! No results for the query entered. Please Try Again.");
          console.log("An error occured!! ")

        },
       });
    });

    $('#tab-2').on('click', function(){
        $('#table-2').html(" ");
        $('#table-3').html(" ");
        $('#table-4').html(" ");
        $('#top-table').css({'display' : 'block'});
        $('#bottom-table').css({'display' : 'block'});
        function sortByRpast(a, b){
          var aValue = a.value;
          var bValue = b.value;
          return ((aValue > bValue) ? -1 : ((aValue < bValue) ? 1 : 0));
        }  
        
        rPastDictList.sort(sortByRpast);
        console.log(rPastDictList);  
        lenRpastList = rPastDictList.length;
        reqlen = parseInt(0.1*(lenRpastList)); 
        console.log(reqlen);
        var positiveSum = 0;
        var negSum = 0;
        for(var i =0; i<=reqlen; i++){
          positiveSum += rPastDictList[i]["rfut"];
          $('#table-2').append('<tr style = "color : white"><td style = "color : white">' + rPastDictList[i]["key"] + '</td>\
          <td>' + rPastDictList[i]["value"] + '</td><td>' + rPastDictList[i]["rfut"] + '</td></tr>');

        }

        for(var i =reqlen; i>=parseInt(reqlen/2); i--){
          negSum += rPastDictList[i]["rfut"];
          console.log(rPastDictList[i]["key"]); 
          $('#table-3').append('<tr style = "color : white"><td style = "color : white">' + rPastDictList[i]["key"] + '</td>\
          <td>' + rPastDictList[i]["value"] + '</td><td>' + rPastDictList[i]["rfut"] + '</td></tr>');

        }
        
        
        positiveMoment = positiveSum/(reqlen + 1)
        negMoment = negSum/(lenRpastList-reqlen)
        var diff = positiveSum - negMoment;
        console.log(positiveMoment);

        $('#momentum').css({'display' : 'block'})
        $('#momentum').on('click', function(){
          $('#moment-table').css({'display' : 'block'});
          console.log("in moment");
          $('#table-4').append('<tr style = "color : white"><td style = "color : white">' + positiveMoment + '</td>\
          <td>' + negMoment + '</td><td>' + diff + '</td></tr>');
        });
        
        
    });  
});

  

  
</script>


</body>

</html>


<!-- e table-condensed">
          <thead>
            <tr>
              <th>Company Name</th>
              <th>Industry</th>
              <th>Symbol</th>
            </tr>
            <tr>
              <td>ABB India Ltd.</td>
              <td>INDUSTRIAL MANUFACTURING</td>
              <td>ABB</td>
            </tr>
            <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr>             
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
             <tr>
              <td>Steel Authority of India</td>
              <td>METALS</td>
              <td>SAIL</td>
             </tr> 
          </thead>
        </table> -->